user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
	worker_connections 768;
	# multi_accept on;
}

http {

	##
	# Basic Settings
	##

	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	keepalive_timeout 65;
	types_hash_max_size 2048;
	# server_tokens off;

	# server_names_hash_bucket_size 64;
	# server_name_in_redirect off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	##
	# SSL Settings
	##

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;

	##
	# Logging Settings
	##

	access_log off;
	error_log off;

	##
	# Gzip Settings
	##
	gzip off;

	##
	# Virtual Host Configs
	##
	upstream terminal {
	server 127.0.0.1:4200;
	keepalive 64;
	}

	server {
	listen 80;
	listen [::]:80;
	#listen 443 ssl http2;	listen [::]:443 http2 ssl;
  ssl_certificate /drouter/dsystem/etc/ssl/csr.crt;	        ssl_certificate_key /drouter/dsystem/etc/ssl/rsa.key;	        ssl_stapling off;	        ssl_stapling_verify off;	        add_header Strict-Transport-Security max-age=15768000;
	client_max_body_size 20000M;
	index index.php;
	root /drouter/web;
	charset utf-8;
	 #   default_type text/plain;

	error_page 401 /401;
	location /401 {
	  default_type text/html;
	  return 401 "<title>Router - Dijitaller.net</title><div style='center;margin: 20%;'><h1 style='color: red; text-align:'>401 Yetkisiz eri≈üim </br> 401 UNAUTHORIZED	</br> <a href='https://dijitaller.net'>dijitaller.net</a></br>$remote_addr</h1>	</div> ";
	}
	error_page 404 /index.php;
	server_name _;

	#if ($block_these_turkeys) {
	#    set $test  A;
	#    }
	#if ($server_port = 443) {
	#	set $test  "${test}B";
	#}
	# if ($test = AB) {
	#    return 401;
	#    }


	location / {

	expires 500m;
  try_files $uri $uri/ /index.php?$args;
	add_header X-Cache $upstream_cache_status;
	#add_header Admin "Server System created by ahmetozer.org";
	add_header Cache-Control "max-age=6000";
	}

	location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
		expires 24h;
		log_not_found off;
	}
		location ~* ^.+\.(ogg|ogv|svg|svgz|eot|otf|woff|mp4|ttf|rss|atom|jpg|jpeg|gif|png|ico|zip|tgz|gz|rar|bz2|doc|xls|exe|ppt|tar|mid|midi|wav|bmp|rtf)$ {
			access_log off;
			log_not_found off;
			expires max;
		}

		location ~ \.php$ {
			try_files $uri =404;
			fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
			fastcgi_split_path_info ^(.+\.php)(/.+)$;
			fastcgi_pass unix:/run/php/urouter.sock;
			#fastcgi_index index.php;
			include fastcgi_params;
			###   PHP cache   ###
			#	fastcgi_buffer_size 128m;
			#fastcgi_buffers 256 16m;
			#fastcgi_busy_buffers_size 256m;
			#fastcgi_temp_file_write_size 256m;
			#	#add_header X-Cache $upstream_cache_status;
			#fastcgi_cache CACHE;
			#fastcgi_cache_valid 30d;
			#fastcgi_cache_bypass $skip_cache;
			#fastcgi_no_cache $skip_cache;
			#limit_req zone=one burst=2;
	}

	location /deluge {
	    proxy_pass http://localhost:1454/;
	    proxy_set_header X-Deluge-Base "/deluge/";
	    #include proxy-control.conf;
	    add_header X-Frame-Options SAMEORIGIN;
	expires 60m;
	}





	      location ^~ /transmission {
		  error_page 502 http://10.0.0.5:1453/pages/tnotwroking.html;

	          proxy_set_header X-Real-IP $remote_addr;
	          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	          proxy_set_header Host $http_host;
	          proxy_set_header X-NginX-Proxy true;
	          proxy_http_version 1.1;
	          proxy_set_header Connection "";
	          proxy_pass_header X-Transmission-Session-Id;
	          add_header   Front-End-Https   on;

	          location /transmission/rpc {
	              proxy_pass http://10.20.1.2:9091;
	          }

	          location /transmission/web/ {
	              proxy_pass http://10.20.1.2:9091;
	          }

	          location /transmission/upload {
	              proxy_pass http://10.20.1.2:9091;
	          }

	          location /transmission/web/style/ {
	              alias /usr/share/transmission/web/style/;
	          }

	          location /transmission/web/javascript/ {
	              alias /usr/share/transmission/web/javascript/;
	          }

	          location /transmission/web/images/ {
	              alias /usr/share/transmission/web/images/;
	          }

	          location /transmission/ {
	              return 301 https://$server_name/transmission/web;
	          }
	      }

	 location ^~ /ipcameralive {

	          #proxy_set_header X-Real-IP $remote_addr;
	          #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	          #proxy_set_header Host $http_host;
	          proxy_set_header X-NginX-Proxy true;
	          proxy_http_version 1.1;
	          proxy_set_header Connection "";
	          proxy_pass_header X-Transmission-Session-Id;
	          add_header   Front-End-Https   on;
	          location /ipcameralive {
	          proxy_pass http://127.0.0.1:8844;
	          }
	}

	 location ^~ /ipcameracontrol {

	          proxy_set_header X-Real-IP $remote_addr;
	          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	          proxy_set_header Host $http_host;
	          proxy_set_header X-NginX-Proxy true;
	          proxy_http_version 1.1;
	          proxy_set_header Connection "";
	          proxy_pass_header X-Transmission-Session-Id;
	          add_header   Front-End-Https   on;
	          proxy_pass http://127.0.0.1:8845;
		}
	}


	##
	# End line
	##
}
